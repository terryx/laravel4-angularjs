var app=angular.module("App",["ngResource","ui.bootstrap","Api","Service"]);app.config(["$routeProvider","$locationProvider",function(b,a){b.when("/",{templateUrl:"templates/video.html",controller:"VideoController"}).when("/video/s/:query",{templateUrl:"templates/video.html",controller:"VideoController"}).when("/video/id/:id",{templateUrl:"templates/single-video.html",controller:"SingleVideoController"}).when("/login",{templateUrl:"templates/login.html",controller:"LoginController"});a.html5Mode(true)}]);app.run(["$rootScope","pagination",function(a){a.dataStorage={}}]);app.controller("SearchController",["$rootScope","$scope","VideoApi","pagination","$location",function(b,d,a,c,e){d.search=function(g){if(e.$$path!=="/"&&e.$$path!=="/video"){e.path("/video/s/"+g);return}var f=b.videoCount(g);f.then(function(h){if(undefined===h.count){return}c.make(h.count,g);b.pagination=c.model}).then(function(){b.listVideo()})}}]);app.controller("VideoController",["$scope","VideoApi","$q","pagination","$rootScope","dataStorage","$location",function(h,a,e,i,f,d,c){var j=c.$$path.split("/");var b="";if(j.length===4){b=j[3]}f.videoCount=function(l){var k=e.defer();a.Count({query:l}).get(function(m){k.resolve(m)});return k.promise};var g=f.videoCount(b);g.then(function(k){if(undefined===k.count){return}i.make(k.count,b);f.pagination=i.model}).then(function(){h.$watch("pagination.currentPage",function(k){f.pagination.currentPage=k;f.listVideo()})});f.listVideo=function(){var l="vp-"+i.model.query+f.pagination.currentPage;var k=d.getCache(l);if(k){f.dataStorage.rows=k;return}a.List(f.pagination).query(function(m){if(m){f.dataStorage.rows=m;d.setCache(l,m)}})};h.youtube_parser=function(m){var l=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;var k=m.match(l);if(k&&k[2].length==11){return k[2]}else{console.log("incorrect url")}};h.view=function(l){var k=l.url;h.youtube_id=h.youtube_parser(k);c.path("/video/id/"+h.youtube_id)}}]);app.controller("SingleVideoController",["$scope","$location",function(a,c){var b=c.$$path.split("/");a.youtube_id=b[3]}]);app.controller("LoginController",["$scope","AuthApi","$location",function(a,b,c){a.user={};a.error="";a.loginAttempt=function(d){b.Auth(d).save(function(e){if(!e){return}if(e.status===200){window.location="/admin"}if(e.status===400){a.error=e.message}})}}]);